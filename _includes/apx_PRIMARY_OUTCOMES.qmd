### CARES

<!-- RAIN PLOT -->
![Rainplot of CARES total score.](_figures/fig-cares-rainplot.png){#fig-cares-rainplot width=100%}

<!-- ESTIMATED MARGINAL MEANS -->
![Estimated marginal means of CARES total score.](_figures/fig-cares-estimated-marginal-means.png){#fig-cares-rainplot width=100%}

<!-- MMRM: TIME SINCE BASELINE -->
```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-cares-mmrm-time-since-baseline
#| tbl-cap: "Explorative MMRM for CARES total score with the covariable time since beginning of the first module. Time since beginning of the first module is defined as the time between the Baseline measurement and the respective consecutive measurement timepoint. Static recidivism risk was assessed with the modified Static-99 [LIT]. Additional treatment refers to community supervision as usual including in-face psychotherapeutical and/or medical treatment. Hands-on offence is defined as at least one convictione .... StGB = German penalty law."
#| html-table-processing: none

library(gtsummary)
library(gt)

# global theme for gtsummary
gtsummary::theme_gtsummary_journal(journal = "lancet")

tbl <- fit2_c %>%
    tbl_regression(
      add_estimate_to_reference_rows = TRUE,
      intercept = TRUE,
      label = list(
        static99_modified_calc = "Static recidivism risk",
        Aktuelle_Betreuung = "Type of supervision",
        Aktuelle_zusatzliche_Behandlung = "Additional treatment",
        Indexdelikt = "Offense type",
        IoD_reduced_baseline = "Baseline value",
        Zeit_seit_Beginn_Modul_1_in_Jahren = "Time since baseline (years)",
        treatment = "Treatment",
        timepoint = "Timepoint",
        `Timepoint * treatment` = "Timepoint * treatment"
      )
    ) %>%
    modify_header(label ~ "**Variable**") %>%
    remove_abbreviation("CI = Confidence Interval") %>%
    modify_abbreviation("CI = Confidence Interval") %>%
    modify_abbreviation("StGB = German penalty law") %>%
    modify_column_alignment(columns = everything(), align = "left") %>%
    modify_table_styling(
        columns = c(estimate, conf.low, conf.high),
        rows = reference_row %in% TRUE,
        missing_symbol = "Ref."
    ) %>%
    bold_labels() %>%
    as_gt() %>%
    gt::tab_options(
      table.font.names = "Times New Roman",
      table.font.size = 10,
      quarto.use_bootstrap = FALSE,
      quarto.disable_processing = TRUE,
      data_row.padding = px(2),
      summary_row.padding = gt::px(2),
      grand_summary_row.padding = gt::px(2),
      #footnotes.padding = gt::px(2),
      #source_notes.padding = gt::px(2),
      row_group.padding = gt::px(2)
    )

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-mmrm-time-since-baseline.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-mmrm-time-since-baseline.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-mmrm-time-since-baseline.png")))

tbl
```

![Estimated marginal means  of the MMRM (CARES total score) with time since baseline as additional covariable.](_figures/fig-cares-estimated-marginal-means-time-since-baseline.png){#fig-cares-rainplot width=100%}

<!-- SENSITIVITY ANALYSIS -->
```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-cares-sensitivity-analysis
#| tbl-cap: "Sensitivity analysis for CARES total score. The table summarizes the results of a reference-based multiple imputation followed by ANCOVA models for the difference in the CARES compared to baseline."
library(gt)

# global theme for gtsummary
gtsummary::theme_gtsummary_journal(journal = "lancet")

tbl <- rbmi_cares_tab %>%
            gt() %>%
            gt::tab_options(
                table.font.size = 10,
                data_row.padding = gt::px(2),
                summary_row.padding = gt::px(2),
                grand_summary_row.padding = gt::px(2),
                #footnotes.padding = gt::px(2),
                #source_notes.padding = gt::px(2),
                row_group.padding = gt::px(2)
            )

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-sensitivity-analysis.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-sensitivity-analysis.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-sensitivity-analysis.png")))

tbl
```

<!-- PAIRWISE COMPARISONS -->
```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-cares-pairwise-intervention
#| tbl-cap: "Explorative comparison of the CARES total score between before (pre) and after (post) of each module for the intervention arm."

library(here)
source(here::here("_scripts/prim_pairwise_functions.R"))

# global theme for gtsummary
gtsummary::theme_gtsummary_journal(journal = "lancet")

variable <- "IoD_reduced"
tbl <- create_prim_pairwise_tbls(variable, subgroup_str = "Intervention")

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-pairwise-intervention.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-pairwise-intervention.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-pairwise-intervention.png")))

tbl
```

::: {.landscape}

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-cares-pairwise-placebo
#| tbl-cap: "Explorative comparison of the CARES total score between before (pre) and after (post) of each module for the placebo arm."

variable <- "IoD_reduced"
tbl <- create_prim_pairwise_tbls(variable, subgroup_str = "Placebo")

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-pairwise-intervention.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-pairwise-intervention.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-pairwise-intervention.png")))

tbl
```

:::

<!-- DIFFERENCES FROM BASELINE -->

::: {.landscape}

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-cares-diffscore
#| tbl-cap: "Difference of the CARES total score between before (pre) and after (post) each module. Differences from baseline have been compared exploratively between the treatment groups in a explorative manner using the Brunner-Munzel test for unpaired data. The table shows descriptive statistics as well as the results for the multiple Brunner-Munzel tests for unpaired data."

library(here)
source(here::here("_scripts/prim_diffscore_functions.R"))

# global theme for gtsummary
gtsummary::theme_gtsummary_journal(journal = "lancet")

variable <- "IoD_reduced"
tbl <- create_prim_diffscore_tbl(variable)

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-diffscore.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-diffscore.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-cares-diffscore.png")))

tbl
```

:::

<!-- RAIN PLOT -->
![Rainplot of primary outcome CARES difference from baseline scores.](_figures/fig-cares-rainplot-difference-from-baseline.png){#fig-cares-rainplot width=100%}

{{< pagebreak >}}

### Index of Desistance (IoD)

<!-- RAIN PLOT -->
![Rainplot of primary outcome IoD total score.](_figures/fig-iod-rainplot.png){#fig-iod-rainplot width=100%}


<!-- MMRM -->
```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-iod-mmrm
#| tbl-cap: "Mixed model for repeated measures (MMRM) for the IoD total score. StGB = German penalty law."
#| html-table-processing: none

library(gtsummary)
library(gt)

# global theme for gtsummary
gtsummary::theme_gtsummary_journal(journal = "lancet")

tbl <- fit %>%
    tbl_regression(
      add_estimate_to_reference_rows = TRUE,
      intercept = TRUE,
      label = list(
        static99_modified_calc = "Static recidivism risk",
        Aktuelle_Betreuung = "Type of supervision",
        Aktuelle_zusatzliche_Behandlung = "Additional treatment",
        Indexdelikt = "Offense type",
        IoD_reduced_baseline = "Baseline value",
        Zeit_seit_Beginn_Modul_1_in_Jahren = "Time since baseline (years)",
        treatment = "Treatment",
        timepoint = "Timepoint",
        `Timepoint * treatment` = "Timepoint * Treatment"
      )
    ) %>%
    modify_header(label ~ "**Variable**") %>%
    remove_abbreviation("CI = Confidence Interval") %>%
    modify_abbreviation("CI = Confidence Interval") %>%
    modify_abbreviation("StGB = German penalty law") %>%
    modify_column_alignment(columns = everything(), align = "left") %>%
    modify_table_styling(
        columns = c(estimate, conf.low, conf.high),
        rows = reference_row %in% TRUE,
        missing_symbol = "Ref."
    ) %>%
    bold_labels() %>%
    as_gt() %>%
    gt::tab_options(
      table.font.names = "Times New Roman",
      table.font.size = 10,
      quarto.use_bootstrap = FALSE,
      quarto.disable_processing = TRUE,
      data_row.padding = px(2),
      summary_row.padding = gt::px(2),
      grand_summary_row.padding = gt::px(2),
      #footnotes.padding = gt::px(2),
      #source_notes.padding = gt::px(2),
      row_group.padding = gt::px(2)
    )

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-mmrm.png")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-mmrm.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-mmrm.docx")))

tbl
```

<!-- ESTIMATED MARGINAL MEANS -->
![Estimated marginal means of the MMRM for the IoD total score. The pre-specified MMRM considers all strata as well as the baseline value of the IoD total score as covariables.](_figures/fig-iod-estimated-marginal-means.png){#fig-iod-rainplot width=100%}

<!-- MMRM -->
```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-iod-mmrm-time-since-baseline
#| tbl-cap: "Explorative MMRM for IoD total score with the covariable time since beginning of the first module. Additionally to the strata the time difference between the baseline measure and the respective consecutive timepoints is added as covariable to the MMRM. StGB = German penalty law."
#| html-table-processing: none

library(gtsummary)
library(gt)

# global theme for gtsummary
gtsummary::theme_gtsummary_journal(journal = "lancet")

tbl <- fit1_c %>%
    tbl_regression(
      add_estimate_to_reference_rows = TRUE,
      intercept = TRUE,
      label = list(
        static99_modified_calc = "Static recidivism risk",
        Aktuelle_Betreuung = "Type of supervision",
        Aktuelle_zusatzliche_Behandlung = "Additional treatment",
        Indexdelikt = "Offense type",
        IoD_reduced_baseline = "Baseline value",
        Zeit_seit_Beginn_Modul_1_in_Jahren = "Time since baseline (years)",
        treatment = "Treatment",
        timepoint = "Timepoint",
        `Timepoint * treatment` = "Timepoint * Treatment"
      )
    ) %>%
    modify_header(label ~ "**Variable**") %>%
    remove_abbreviation("CI = Confidence Interval") %>%
    modify_abbreviation("CI = Confidence Interval") %>%
    modify_abbreviation("StGB = German penalty law") %>%
    modify_column_alignment(columns = everything(), align = "left") %>%
    modify_table_styling(
        columns = c(estimate, conf.low, conf.high),
        rows = reference_row %in% TRUE,
        missing_symbol = "Ref."
    ) %>%
    bold_labels() %>%
    as_gt() %>%
    gt::tab_options(
      table.font.names = "Times New Roman",
      table.font.size = 10,
      quarto.use_bootstrap = FALSE,
      quarto.disable_processing = TRUE,
      data_row.padding = px(2),
      summary_row.padding = gt::px(2),
      grand_summary_row.padding = gt::px(2),
      #footnotes.padding = gt::px(2),
      #source_notes.padding = gt::px(2),
      row_group.padding = gt::px(2)
    )

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-mmrm-time-since-baseline.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-mmrm-time-since-baseline.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-mmrm-time-since-baseline.png")))

tbl
```

![Estimated marginal means (IoD total score) with time since baseline as additional covariable of the explorative MMRM.](_figures/fig-iod-estimated-marginal-means-time-since-baseline.png){#fig-iod-rainplot width=100%}

<!-- SENSITIVITY ANALYSIS -->
```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-iod-sensitivity-analysis
#| tbl-cap: "Sensitivity analysis for IoD total score. The table summarizes the results of a reference-based multiple imputation followed by ANCOVA models for the difference in the IoD total score compared to baseline."
library(gt)

# global theme for gtsummary
gtsummary::theme_gtsummary_journal(journal = "lancet")

tbl <- rbmi_tab %>%
  gt() %>%
  gt::tab_options(
    table.font.size = 10,
    data_row.padding = gt::px(2),
    summary_row.padding = gt::px(2),
    grand_summary_row.padding = gt::px(2),
    #footnotes.padding = gt::px(2),
    #source_notes.padding = gt::px(2),
    row_group.padding = gt::px(2)
  )

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-sensitivity-analysis.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-sensitivity-analysis.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-sensitivity-analysis.png")))

tbl
```

<!-- PAIRWISE COMPARISONS -->

::: {.landscape}

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-iod-pairwise-intervention
#| tbl-cap: "Explorative (pre-specified) comparison of the IoD total score between before (pre) and after (post) of each module for the intervention arm."

library(here)
source(here::here("_scripts/prim_pairwise_functions.R"))

# global theme for gtsummary
gtsummary::theme_gtsummary_journal(journal = "lancet")

variable <- "IoD"
tbl <- create_prim_pairwise_tbls(variable, subgroup_str = "Intervention")

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-pairwise-intervention.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-pairwise-intervention.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-pairwise-intervention.png")))

tbl
```

:::

::: {.landscape}

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-iod-pairwise-placebo
#| tbl-cap: "Explorative comparison of the IoD total score between before (pre) and after (post) of each module for the placebo arm."

variable <- "IoD"
tbl <- create_prim_pairwise_tbls(variable, subgroup_str = "Placebo")

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-pairwise-intervention.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-pairwise-intervention.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-pairwise-intervention.png")))

tbl
```

:::

<!-- DIFFERENCES FROM BASELINE -->

::: {.landscape}

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-prim-iod-diffscore
#| tbl-cap: "Difference of the IoD total score between before (pre) and after (post) each module. Differences from baseline have been compared exploratively between the treatment groups in a explorative manner using the Brunner-Munzel test for unpaired data. The table shows descriptive statistics as well as the results for the multiple Brunner-Munzel tests for unpaired data."

library(here)
source(here::here("_scripts/prim_diffscore_functions.R"))

# global theme for gtsummary
gtsummary::theme_gtsummary_journal(journal = "lancet")

variable <- "IoD"
tbl <- create_prim_diffscore_tbl(variable)

# save tbl as image
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-diffscore.pdf")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-diffscore.docx")))
gt::gtsave(tbl, file = file.path(here::here("_tables/tbl-prim-iod-diffscore.png")))

tbl
```

:::

<!-- RAIN PLOT -->
![Rainplot of IoD difference from baseline scores.](_figures/fig-iod-rainplot-difference-from-baseline.png){#fig-cares-rainplot width=100%}

